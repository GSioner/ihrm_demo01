(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7d8994af"],{2707:function(e,t,a){"use strict";a("8cba")},"3db6":function(e,t,a){"use strict";a("f3ae")},"5bbb":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));a("d3b7"),a("159b");function n(e,t){var a=[];return e.forEach((function(r){if(""===r.pid&&(r["icon"]="chart"),r.pid===t){var i=n(e,r.id);i.length&&(r["children"]=i),a.push(r)}})),a}},"8cba":function(e,t,a){},f3ae:function(e,t,a){},fb3b:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container"},[a("div",{staticClass:"app-container"},[a("el-card",{staticStyle:{padding:"30px 140px"}},[a("CompanyTree",{attrs:{data:e.company}}),e.rander?a("el-tree",{attrs:{data:e.departsList,props:e.defaultProps,"default-expand-all":!0,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return a("company-tree",{staticClass:"custom-tree-node",attrs:{data:n},on:{reRander:e.reRander}})}}],null,!1,3913082433)}):e._e()],1)],1)])},r=[],i=a("c7eb"),o=a("1da1"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"row-bg tree_main",staticStyle:{"line-height":"40px"},attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("div",[e.data.icon?a("svg-icon",{staticStyle:{"margin-right":"10px"},attrs:{"icon-class":e.data.icon}}):e._e(),a("span",[e._v(e._s(e.data.name))])],1),a("div",[e.data.manager?a("span",{staticStyle:{"margin-right":"50px","font-size":"15px"}},[e._v(e._s(e.data.manager))]):e._e(),a("el-dropdown",{on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link",staticStyle:{"font-size":"15px"}},[e._v(" 操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{staticStyle:{color:"#437dff"},attrs:{disabled:!e.checkPermission("point_add_depts"),command:"add"}},[e._v("添加子部")]),e.data.isHost?e._e():a("el-dropdown-item",{staticStyle:{color:"#437dff"},attrs:{disabled:!e.checkPermission("point_edit_depts"),command:"edit"}},[e._v("编辑子部")]),e.data.isHost?e._e():a("el-dropdown-item",{staticStyle:{color:"#437dff"},attrs:{disabled:!e.checkPermission("point_delete_depts"),command:"del"}},[e._v("删除子部")])],1)],1)],1),a("el-dialog",{staticClass:"dialog",attrs:{title:"警告！",visible:e.deleteDialog,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.deleteDialog=t}}},[a("span",[e._v("确认删除部门？")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deleteDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteDeparts}},[e._v("确 定")])],1)]),a("el-dialog",{attrs:{title:"add"===e.type?"新增部门":"编辑部门",visible:e.addEditDialog,"destroy-on-close":!0},on:{"update:visible":function(t){e.addEditDialog=t},close:e.onCancel}},[a("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[a("el-form-item",{attrs:{label:"部门名称","label-width":e.formLabelWidth,prop:"name"}},[a("el-input",{attrs:{placeholder:"1-50个字符"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"部门编码","label-width":e.formLabelWidth,prop:"code"}},[a("el-input",{attrs:{placeholder:"1-50个字符"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),a("el-form-item",{attrs:{label:"部门负责人","label-width":e.formLabelWidth,prop:"manager"}},[a("el-select",{attrs:{placeholder:"请选择负责人"},on:{focus:e.getCompanyUsername},model:{value:e.form.manager,callback:function(t){e.$set(e.form,"manager",t)},expression:"form.manager"}},e._l(e.companyUsername,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.username}})})),1)],1),a("el-form-item",{attrs:{label:"部门介绍","label-width":e.formLabelWidth,prop:"introduce"}},[a("el-input",{attrs:{type:"textarea",rows:5,placeholder:"1-300个字符"},model:{value:e.form.introduce,callback:function(t){e.$set(e.form,"introduce",t)},expression:"form.introduce"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.onCancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addDepartsData}},[e._v("确 定")])],1)],1)],1)},s=[],d=a("5530"),l=(a("4de4"),a("d3b7"),a("b0c0"),a("fcac")),u={name:"CompanyTree",props:{data:{type:Object,default:function(){return{name:"",icon:"",manager:""}}}},data:function(){return{deleteDialog:!1,addEditDialog:!1,form:{name:"",manager:"",introduce:"",code:""},formLabelWidth:"100px",companyUsername:[],type:"",id:"",rules:{name:[{required:!0,trigger:"blur",message:"请输入部门名称"},{min:1,max:50,trigger:"blur",message:"请输入1-50个之内的字符"},{validator:this.verityName,trigger:"blur"}],manager:[{required:!0,trigger:"change",message:"请输入负责人信息"}],introduce:[{required:!0,trigger:"blur",message:"请输入部门介绍"},{min:1,max:300,trigger:"blur",message:"请输入1-300个之内的字符"}],code:[{required:!0,trigger:"blur",message:"请输入部门编码"},{min:1,max:50,trigger:"blur",message:"请输入1-50个之内的字符"},{validator:this.verityCode,trigger:"blur"}]}}},created:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getCompanyUsername();case 2:case"end":return t.stop()}}),t)})))()},methods:{verityName:function(e,t,a){var n=this;return Object(o["a"])(Object(i["a"])().mark((function e(){var r,o,c,s;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["d"])();case 2:r=e.sent,o=r.depts,c=null,"add"===n.type?(s=o.filter((function(e){return e.pid===n.data.id&&e.name===t})),c=s.length):"edit"===n.type&&(c=o.filter((function(e){return e.id!==n.data.id&&e.pid===n.data.pid})).some((function(e){return e.name===t}))),c?a(new Error("当前已存在该部门")):a();case 7:case"end":return e.stop()}}),e)})))()},verityCode:function(e,t,a){var n=this;return Object(o["a"])(Object(i["a"])().mark((function e(){var r,o,c,s;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["d"])();case 2:r=e.sent,o=r.depts,c=null,"add"===n.type?(s=o.filter((function(e){return e.code===t&&t})),c=s.length):"edit"===n.type&&(c=o.filter((function(e){return e.id!==n.data.id})).some((function(e){return e.code===t}))),c?a(new Error("当前编码已被占用")):a();case 7:case"end":return e.stop()}}),e)})))()},handleCommand:function(e){var t=this;return Object(o["a"])(Object(i["a"])().mark((function a(){var n;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if("del"!==e){a.next=4;break}t.deleteDialog=!0,a.next=16;break;case 4:if("add"!==e){a.next=9;break}t.addEditDialog=!0,t.type="add",a.next=16;break;case 9:if("edit"!==e){a.next=16;break}return a.next=12,Object(l["e"])(t.data.id);case 12:n=a.sent,t.form=Object(d["a"])({},n),t.addEditDialog=!0,t.type="edit";case 16:case"end":return a.stop()}}),a)})))()},deleteDeparts:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(l["b"])(e.data.id);case 3:e.$emit("reRander"),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),e.$message.error(t.t0);case 9:e.deleteDialog=!1;case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()},handleClose:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},getCompanyUsername:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["f"])();case 2:e.companyUsername=t.sent;case 3:case"end":return t.stop()}}),t)})))()},addDepartsData:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a,n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.submitForm("ruleForm");case 2:if(a=e.getFormData(),"add"!==e.type){t.next=9;break}return t.next=6,Object(l["a"])(a);case 6:n=t.sent,e.id=n._id,e.addAndEditCodeFn();case 9:if("edit"!==e.type){t.next=13;break}return t.next=12,Object(l["c"])(a);case 12:e.addAndEditCodeFn();case 13:case"end":return t.stop()}}),t)})))()},getFormData:function(){return Object(d["a"])(Object(d["a"])({},this.form),{},{pid:this.data.id||""})},addAndEditCodeFn:function(){this.$emit("reRander"),this.addEditDialog=!1},submitForm:function(e){this.$refs[e].validate((function(e){if(!e)return!1;console.log("验证成功")}))},onCancel:function(){this.form={name:"",manager:"",introduce:"",code:""},this.addEditDialog=!1}}},m=u,p=(a("3db6"),a("2877")),f=Object(p["a"])(m,c,s,!1,null,"58612815",null),b=f.exports,h=a("5bbb"),g={components:{CompanyTree:b},data:function(){return{company:{},msg:"",rander:!0,departsList:[],defaultProps:{label:"name",children:"children"},loading:!1}},created:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDepartsData();case 2:case"end":return t.stop()}}),t)})))()},methods:{getDepartsData:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var a;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(l["d"])();case 2:a=t.sent,e.company={name:a.companyName,manager:"负责人",isHost:!0,icon:"chart",pid:"",id:""},e.departsList=Object(h["a"])(a.depts,"");case 5:case"end":return t.stop()}}),t)})))()},reRander:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("数据刷新中"),e.loading=!0,t.next=4,e.getDepartsData();case 4:e.rander=!1,setTimeout((function(){e.rander=!0}),0),e.loading=!1;case 7:case"end":return t.stop()}}),t)})))()}}},v=g,w=(a("2707"),Object(p["a"])(v,n,r,!1,null,"c980e8ea",null));t["default"]=w.exports},fcac:function(e,t,a){"use strict";a.d(t,"d",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return s})),a.d(t,"e",(function(){return d}));var n=a("b775"),r=function(){return Object(n["a"])({url:"/company/department"})},i=function(){return Object(n["a"])({url:"/sys/user/simple"})},o=function(e){return Object(n["a"])({url:"/company/department/".concat(e),method:"DELETE"})},c=function(e){return Object(n["a"])({url:"/company/department",method:"POST",data:e})},s=function(e){return Object(n["a"])({url:"/company/department",method:"PUT",data:e})},d=function(e){return Object(n["a"])({url:"/company/department/".concat(e)})}}}]);